angular.module("richcc.bootstrap.datepicker",["ui.bootstrap","ui.bootstrap.dateparser","ui.bootstrap.isClass","ui.bootstrap.position","FredrikSandell.worker-pool"]).value("$datepickerSuppressError",!1).constant("richccDatepickerConfig",{datepickerMode:"day",formatDay:"dd",formatMonth:"MMMM",formatYear:"yyyy",formatDayHeader:"EEE",formatDayTitle:"MMMM yyyy",formatMonthTitle:"yyyy",maxDate:null,maxMode:"year",minDate:null,minMode:"day",ngModelOptions:{},shortcutPropagation:!1,showWeeks:!0,yearColumns:5,yearRows:4,light:!1,yearMapHeat:!1,preventModeToggle:!1,preventCalNav:!1,stopHighlight:!1,hideCalNav:!1,showMarkerForMoreEvents:!0,showDataLabel:!1,defaultDataLabel:"00:00",monthPopUpTmpl:"template/richcc/richccMonthPopup.html",dayPopUpTmpl:"template/richcc/richccDayPopup.html",enableWebWorkers:!1,expandedMode:!1,webWorkerAngularPath:"https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.8/angular.min.js"}).service("richCCShared",function(){var e=this;return e.enableWebWorkers=!1,e.webWorkerAngularPath="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.8/angular.min.js",e}).controller("RichccDatepickerController",["$scope","$timeout","$attrs","$parse","$interpolate","$locale","$log","dateFilter","richccDatepickerConfig","$datepickerSuppressError","uibDateParser","richCCShared",function(e,t,n,a,r,i,o,c,l,s,u,p){var d=this,f={$setViewValue:angular.noop},h={},v=[];this.modes=["day","month","year"],n.datepickerOptions?angular.forEach(["enableWebWorkers","expandedMode","light","yearMapHeat","preventModeToggle","preventCalNav","stopHighlight","hideCalNav","showMarkerForMoreEvents","showDataLabel","defaultDataLabel","monthPopUpTmpl","dayPopUpTmpl","customClass","customAriaLabel","customIconClass","datepickerMode","formatDay","formatDayHeader","formatDayTitle","formatMonth","formatMonthTitle","formatYear","initDate","maxDate","maxMode","minDate","minMode","showWeeks","shortcutPropagation","startingDay","yearColumns","yearRows"],function(t){switch(t){case"enableWebWorkers":case"expandedMode":case"stopHighlight":case"webWorkerAngularPath":case"webWorkerUnderscorePath":d[t]=p[t]=e[t]=angular.isDefined(e.datepickerOptions[t])?e.datepickerOptions[t]:l[t],e.datepickerOptions[t]&&e.$watch(function(){return e.datepickerOptions[t]},function(n){d[t]=e[t]=angular.isDefined(n)?n:datepickerOptions[t],d.refreshView()});break;case"yearMapHeat":d[t]=e[t]=!1;break;case"light":case"preventModeToggle":case"preventCalNav":case"hideCalNav":case"showMarkerForMoreEvents":case"showDataLabel":case"defaultDataLabel":case"monthPopUpTmpl":case"dayPopUpTmpl":d[t]=e[t]=angular.isDefined(e.datepickerOptions[t])?e.datepickerOptions[t]:l[t],e.datepickerOptions[t]&&e.$watch(function(){return e.datepickerOptions[t]},function(n){d[t]=e[t]=angular.isDefined(n)?n:datepickerOptions[t],d.refreshView()});break;case"customIconClass":case"customAriaLabel":case"customClass":d[t]=e[t]=e.datepickerOptions[t]||angular.noop;break;case"datepickerMode":d[t]=e[t]=angular.isDefined(e.datepickerOptions.datepickerMode)?e.datepickerOptions.datepickerMode:l.datepickerMode;break;case"formatDay":case"formatDayHeader":case"formatDayTitle":case"formatMonth":case"formatMonthTitle":case"formatYear":d[t]=angular.isDefined(e.datepickerOptions[t])?r(e.datepickerOptions[t])(e.$parent):l[t];break;case"showWeeks":case"shortcutPropagation":case"yearColumns":case"yearRows":d[t]=angular.isDefined(e.datepickerOptions[t])?e.datepickerOptions[t]:l[t];break;case"startingDay":angular.isDefined(e.datepickerOptions.startingDay)?d.startingDay=e.datepickerOptions.startingDay:angular.isNumber(l.startingDay)?d.startingDay=l.startingDay:d.startingDay=(i.DATETIME_FORMATS.FIRSTDAYOFWEEK+8)%7;break;case"maxDate":case"minDate":e.datepickerOptions[t]?e.$watch(function(){return e.datepickerOptions[t]},function(e){e?angular.isDate(e)?d[t]=u.fromTimezone(new Date(e),h.timezone):d[t]=new Date(c(e,"medium")):d[t]=null,d.refreshView()}):d[t]=l[t]?u.fromTimezone(new Date(l[t]),h.timezone):null;break;case"maxMode":case"minMode":e.datepickerOptions[t]?e.$watch(function(){return e.datepickerOptions[t]},function(n){d[t]=e[t]=angular.isDefined(n)?n:datepickerOptions[t],("minMode"===t&&d.modes.indexOf(e.datepickerMode)<d.modes.indexOf(d[t])||"maxMode"===t&&d.modes.indexOf(e.datepickerMode)>d.modes.indexOf(d[t]))&&(e.datepickerMode=d[t])}):d[t]=e[t]=l[t]||null;break;case"initDate":e.datepickerOptions.initDate?(this.activeDate=u.fromTimezone(e.datepickerOptions.initDate,h.timezone)||new Date,e.$watch(function(){return e.datepickerOptions.initDate},function(e){e&&(f.$isEmpty(f.$modelValue)||f.$invalid)&&(d.activeDate=u.fromTimezone(e,h.timezone),d.refreshView())})):this.activeDate=new Date}}):(angular.forEach(["formatDay","formatMonth","formatYear","formatDayHeader","formatDayTitle","formatMonthTitle"],function(t){d[t]=angular.isDefined(n[t])?r(n[t])(e.$parent):l[t]}),angular.forEach(["showWeeks","yearRows","yearColumns","shortcutPropagation"],function(t){d[t]=angular.isDefined(n[t])?e.$parent.$eval(n[t]):l[t]}),angular.isDefined(n.startingDay)?d.startingDay=e.$parent.$eval(n.startingDay):angular.isNumber(l.startingDay)?d.startingDay=l.startingDay:d.startingDay=(i.DATETIME_FORMATS.FIRSTDAYOFWEEK+8)%7,angular.forEach(["minDate","maxDate"],function(t){n[t]?v.push(e.$parent.$watch(n[t],function(e){e?angular.isDate(e)?d[t]=u.fromTimezone(new Date(e),h.timezone):d[t]=new Date(c(e,"medium")):d[t]=null,d.refreshView()})):d[t]=l[t]?u.fromTimezone(new Date(l[t]),h.timezone):null}),angular.forEach(["minMode","maxMode"],function(t){n[t]?v.push(e.$parent.$watch(n[t],function(a){d[t]=e[t]=angular.isDefined(a)?a:n[t],("minMode"===t&&d.modes.indexOf(e.datepickerMode)<d.modes.indexOf(d[t])||"maxMode"===t&&d.modes.indexOf(e.datepickerMode)>d.modes.indexOf(d[t]))&&(e.datepickerMode=d[t])})):d[t]=e[t]=l[t]||null}),n.light&&v.push(e.$parent.$watch(n.light,function(t){d.light=e.light=angular.isDefined(t)?t:n.light,d.refreshView()})),n.yearMapHeat&&v.push(e.$parent.$watch(n.yearMapHeat,function(t){d.yearMapHeat=e.yearMapHeat=angular.isDefined(t)?t:n.yearMapHeat,d.refreshView()})),n.enableWebWorkers&&v.push(e.$parent.$watch(n.enableWebWorkers,function(t){d.enableWebWorkers=e.enableWebWorkers=angular.isDefined(t)?t:n.enableWebWorkers,d.refreshView()})),n.expandedMode&&v.push(e.$parent.$watch(n.expandedMode,function(t){d.expandedMode=e.expandedMode=angular.isDefined(t)?t:n.expandedMode,d.refreshView()})),n.preventCalNav&&v.push(e.$parent.$watch(n.preventCalNav,function(t){d.preventCalNav=e.preventCalNav=angular.isDefined(t)?t:n.preventCalNav,d.refreshView()})),n.preventModeToggle&&v.push(e.$parent.$watch(n.preventModeToggle,function(t){d.preventModeToggle=e.preventModeToggle=angular.isDefined(t)?t:n.preventModeToggle,d.refreshView()})),angular.isDefined(n.initDate)?(this.activeDate=u.fromTimezone(e.$parent.$eval(n.initDate),h.timezone)||new Date,v.push(e.$parent.$watch(n.initDate,function(e){e&&(f.$isEmpty(f.$modelValue)||f.$invalid)&&(d.activeDate=u.fromTimezone(e,h.timezone),d.refreshView())}))):this.activeDate=new Date),e.datepickerOptions.getCalendarInFocus=function(){var t=document.getElementById("tb"+e.datePickerUID);t&&$(t).focus()},n.events&&v.push(e.$parent.$watch(n.events,function(t){d._events=e.events=angular.isDefined(t)?t:n.events,e.monthViewData={},e.monthWiseEventDetails={},e.monthWiseEventMarkers={},d.refreshView()})),n.dayLabels&&v.push(e.$parent.$watch(n.dayLabels,function(t){d._dayLabels=e.dayLabels=angular.isDefined(t)?t:n.dayLabels,d.refreshView()})),n.eventPopupHide&&v.push(e.$parent.$watch(n.eventPopupHide,function(t){d.eventPopupHide=e.eventPopupHide=angular.isDefined(t)?t:n.eventPopupHide,d.refreshView()})),e.datepickerMode=e.datepickerMode||l.datepickerMode,e.uniqueId="datepicker-"+e.$id+"-"+Math.floor(1e4*Math.random()),e.datePickerUID="dpt_"+Math.floor(1e3*Math.random()),e.disabled=angular.isDefined(n.disabled)||!1,angular.isDefined(n.ngDisabled)&&v.push(e.$parent.$watch(n.ngDisabled,function(t){e.disabled=t,d.refreshView()})),e.isActive=function(t){return 0===d.compare(t.date,d.activeDate)?(e.activeDateId=t.uid,!0):!1},this.init=function(e){f=e,h=e.$options||l.ngModelOptions,f.$modelValue&&(this.activeDate=f.$modelValue),f.$render=function(){d.render()}},this.render=function(){if(f.$viewValue){var e=new Date(f.$viewValue),t=!isNaN(e);t?this.activeDate=u.fromTimezone(e,h.timezone):s||o.error('Datepicker directive: "ng-model" value must be a Date object')}this.refreshView()},this.refreshView=function(){if(this.element){if(e.selectedDt=null,this._refreshView(),e.activeDt){e.activeDateId=e.activeDt.uid;var t="#"+e.activeDateId+" span.date-num";setTimeout(function(){var n=document.querySelector(t);n&&(n.innerHTML='<span style="position: absolute;clip: rect(1px, 1px, 1px, 1px);padding: 0;border: 0;height: 1px;width: 1px;overflow: hidden;">'+e.activeDt.label+"</span>"+(e.activeDt.ariaHelpLabel?'<span style="position: absolute;clip: rect(1px, 1px, 1px, 1px);padding: 0;border: 0;height: 1px;width: 1px;overflow: hidden;">'+e.activeDt.ariaHelpLabel+"</span>":""));var n=document.querySelector("#tb"+e.datePickerUID+"[aria-activedescendant]");n&&n.setAttribute("aria-activedescendant",e.activeDateId)},100)}var n=f.$viewValue?new Date(f.$viewValue):null;n=u.fromTimezone(n,h.timezone),f.$setValidity("dateDisabled",!n||this.element&&!this.isDisabled(n)),"month"==e.datepickerMode&&e.$broadcast("refreshMonth",e.activeDt)}},this.createDateObject=function(t,n){var a=f.$viewValue?new Date(f.$viewValue):null;a=u.fromTimezone(a,h.timezone);var r={date:t,label:c(t,n.replace(/d!/,"dd")).replace(/M!/,"MM"),selected:a&&0===this.compare(t,a),disabled:this.isDisabled(t),current:0===this.compare(t,new Date),customClass:this.customClass(t)||null,customAriaLabel:this.customAriaLabel(t)||null,customIconClass:this.customIconClass(t)||null};return a&&0===this.compare(t,a)&&(e.selectedDt=r),d.activeDate&&0===this.compare(r.date,d.activeDate)&&(e.activeDt=r),r},this.isDisabled=function(t){return e.disabled||this.minDate&&this.compare(t,this.minDate)<0||this.maxDate&&this.compare(t,this.maxDate)>0||n.dateDisabled&&e.dateDisabled({date:t,mode:e.datepickerMode})},this.customClass=function(t){return e.customClass({date:t,mode:e.datepickerMode})},this.customAriaLabel=function(t){return e.customAriaLabel({date:t,mode:e.datepickerMode})},this.customIconClass=function(t){return e.customIconClass({date:t,mode:e.datepickerMode})},this.split=function(e,t){for(var n=[];e.length>0;)n.push(e.splice(0,t));return n},e.triggerPopUpIfAvailable=function(n){var a=document.getElementById(e.activeDt.uid);a&&t(function(){$(a).trigger("click")})},e.select=function(t){if(e.datepickerMode===d.minMode){var n=f.$viewValue?u.fromTimezone(new Date(f.$viewValue),h.timezone):new Date(0,0,0,0,0,0,0);n.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),n=u.toTimezone(n,h.timezone),f.$setViewValue(n),f.$render()}else d.activeDate=t,e.datepickerMode=d.modes[d.modes.indexOf(e.datepickerMode)-1]},e.move=function(t){var n=d.activeDate.getFullYear()+t*(d.step.years||0),a=d.activeDate.getMonth()+t*(d.step.months||0);d.activeDate.setFullYear(n,a,1),d.refreshView();var r={datepickerMode:e.datepickerMode,activeDate:d.activeDate};"function"==typeof e.datepickerOptions.moveModeCallback&&e.datepickerOptions.moveModeCallback(r)},e.toggleMode=function(t){var n={datepickerMode:e.datepickerMode,activeDate:d.activeDate};"function"==typeof e.datepickerOptions.toggleModeCallBack&&e.datepickerOptions.toggleModeCallBack(n),this.light||this.preventModeToggle||(t=t||1,e.datepickerMode===d.maxMode&&1===t||e.datepickerMode===d.minMode&&-1===t||(e.datepickerMode=d.modes[d.modes.indexOf(e.datepickerMode)+t]))},e.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"};var g=function(){d.element[0].focus()};e.$on("uib:datepicker.focus",g),e.keydown=function(t){var n=e.keys[t.which];if(n&&!t.shiftKey&&!t.altKey&&!e.disabled)if(t.preventDefault(),d.shortcutPropagation||t.stopPropagation(),"enter"===n||"space"===n){if(d.isDisabled(d.activeDate))return;e.triggerPopUpIfAvailable(d.activeDate)}else!t.ctrlKey||"up"!==n&&"down"!==n?(d.handleKeyDown(n,t),d.refreshView()):e.toggleMode("up"===n?1:-1)},e.$on("$destroy",function(){for(;v.length;)v.shift()()})}]).controller("RichccDaypickerController",["$scope","$timeout","$element","dateFilter","WorkerService","richCCShared",function(e,t,n,a,r,i){function o(e,t){return 1!==t||e%4!==0||e%100===0&&e%400!==0?y[t]:29}function c(e){var t=new Date(e);t.setDate(t.getDate()+4-(t.getDay()||7));var n=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((n-t)/864e5)/7)+1}function l(e,t){return t>e?-1:e==t?0:e>t?1:void 0}function s(e,t){var n=[],a=Math.abs(new Date(e).getTime()-new Date(t).getTime()),r=Math.ceil(a/864e5)+1;return _.each(_.range(r),function(t){var a=new Date(e);a=a.setDate(a.getDate()+t),n.push(new Date(a))}),n}function u(e){for(var t=!0,n=1;t;){var a=_.find(e,function(e){return e.order==n});"undefined"==typeof a?t=!1:n+=1}return n}function p(e){return e.length>0?(e=e.sort(function(e,t){return e.order-t.order}),e[e.length-1].order+1):1}function d(e,t){var n=_.find(t,function(t){return t.date.getDate()==e.getDate()&&t.date.getMonth()==e.getMonth()&&t.date.getFullYear()==e.getFullYear()});return"undefined"==typeof n?!1:!0}function f(e,t){var n=!1;if(t.length>0){var a=t.length;if(t[0].length>0){var r=t[a-1].length;e>=t[0][0].date&&e<=t[a-1][r-1].date&&(n=!0)}}return n}function h(e,t){var n=!1;if(t.length>0){t.length;if(t[0].length>0){var a=t[2][3],r=new Date(a.date.getFullYear(),a.date.getMonth(),1).setHours(0,0,0,0),i=new Date(a.date.getFullYear(),a.date.getMonth()+1,0).setHours(0,0,0,0);e>=r&&i>=e&&(n=!0)}}return n}function v(e,t){var n=[];if(t.length>0){var a=t.length;if(t[0].length>0){var r=t[2][3],i=new Date(r.date.getFullYear(),r.date.getMonth()+1,0).setHours(0,0,0,0);n=_.filter(e,function(e){t[a-1].length;return e>=t[0][0].date&&i>=e&&new Date(e).getMonth()==new Date(i).getMonth()})}}return n}function g(e,t,n){var a=(s(n,t),_.filter(e,function(e){return e>=t}));return a.length}function m(e,t){var n={date:e,label:a(e,t.replace(/d!/,"dd")).replace(/M!/,"MM")};return n}var D,y=[31,28,31,30,31,30,31,31,30,31,30,31],M=e.enableWebWorkers||e.$parent.enableWebWorkers||i.enableWebWorkers;M&&(r.setAngularUrl(i.webWorkerAngularPath),D=r.createAngularWorker(["input","output",function(e,t){function n(e,t){return t>e?-1:e==t?0:e>t?1:void 0}function a(e,t){var n=[],a=Math.abs(new Date(e).getTime()-new Date(t).getTime()),r=Math.ceil(a/864e5)+1;return _.each(_.range(r),function(t){var a=new Date(e);a=a.setDate(a.getDate()+t),n.push(new Date(a))}),n}function r(e){for(var t=!0,n=1;t;){var a=_.find(e,function(e){return e.order==n});"undefined"==typeof a?t=!1:n+=1}return n}function i(e,t){var n=!1;if(t.length>0){var a=t.length;if(t[0].length>0){var r=t[a-1].length;t[0][0].date=new Date(t[0][0].date),t[a-1][r-1].date=new Date(t[a-1][r-1].date),e=new Date(e),e>=t[0][0].date&&e<=t[a-1][r-1].date&&(n=!0)}}return n}function o(e,t){var n=!1;if(t.length>0){t.length;if(t[0].length>0){var a=t[2][3];a.date=new Date(a.date);var r=new Date(a.date.getFullYear(),a.date.getMonth(),1),i=r.setHours(0,0,0,0),o=new Date(a.date.getFullYear(),a.date.getMonth()+1,0),c=o.setHours(0,0,0,0);e>=i&&c>=e&&(n=!0)}}return n}function c(e,t){var n=[];if(t.length>0){var a=t.length;if(t[0].length>0){var r=t[2][3],i=new Date(r.date.getFullYear(),r.date.getMonth()+1,0).setHours(0,0,0,0);n=_.filter(e,function(e){t[a-1].length;return e=new Date(e),t[0][0].date=new Date(t[0][0].date),e>=t[0][0].date&&i>=e})}}return n}function l(e,t,n){var r=(a(n,t),_.filter(e,function(e){return e>=t}));return r.length}function s(e,t){var n=_.find(t,function(t){return t.date.getDate()==e.getDate()&&t.date.getMonth()==e.getMonth()&&t.date.getFullYear()==e.getFullYear()});return"undefined"==typeof n?!1:!0}function u(e,t){var o=_.map(t,function(e){var t=e[0];return t.date=new Date(t.date),t._date=t.date.setHours(0,0,0,0),t}),c=_.map(e,function(e){return e._startDt=new Date(e.startDt).setHours(0,0,0,0),e._endDt=new Date(e.endDt).setHours(0,0,0,0),e.startDtFQ||(e.startDtFQ=e._startDt),e.endDtFQ||(e.endDtFQ=e._endDt),e}),l=c.sort(function(e,t){return e._startDt==t._startDt?n(e._endDt,t._endDt):n(e._startDt,t._startDt)}),u={},p=1;return _.each(l,function(e){var n=a(e._startDt,e._endDt),c={};angular.extend(c,e),c.order=null,c.first=null,_.each(n,function(e,a){var l=i(e,t);if(1==l){var d=e.getFullYear()+"_"+e.getMonth()+"_"+e.getDate();("undefined"==typeof u[d]||null==u[d])&&(u[d]=[]);var f=c.order;0==a&&(c.order=r(u[d])),1==s(e,o)&&(c.order=r(u[d]));var h=c.order;f!=h&&2>=h?c.startPaint=c.startPaintForMonth=!0:c.startPaint=c.startPaintForMonth=!1,1==s(e,o)&&2>=h&&(c.startPaint=!0),c.paintBoxLength=Math.min(7-e.getDay(),n.length-a),c.paintBoxLengthForMonth=n.length,1==c.startPaint&&(c.step=p,p+=1);var v=_.clone(c);u[d].push(v)}})}),u}function p(e,t){var i=_.map(e,function(e){return e._startDt=new Date(e.startDt).setHours(0,0,0,0),e._endDt=new Date(e.endDt).setHours(0,0,0,0),e.startDtFQ||(e.startDtFQ=e._startDt),e.endDtFQ||(e.endDtFQ=e._endDt),e}),s=i.sort(function(e,t){return e._startDt==t._startDt?n(e._endDt,t._endDt):n(e._startDt,t._startDt)}),u={},p={};return _.each(s,function(e){var n=a(e._startDt,e._endDt),i={};angular.extend(i,e),i.order=null,i.first=null,_.each(n,function(a,s){var d=o(a,t);if(1==d){var f=a.getFullYear()+"_"+a.getMonth()+"_"+a.getDate();("undefined"==typeof u[f]||null==u[f])&&(u[f]=[]);var h=i.id+"_"+a.getMonth();if(1!=p[h]){var v=i.order;i.order=r(u[f]);var g=i.order;if(v!=g&&2>=g){i.startPaintForMonth=!0;var m=c(n,t),D=l(m,a,new Date(e._startDt));i.paintBoxLengthForMonth=D,p[h]=!0}else i.startPaintForMonth=!1}else i.startPaintForMonth=!1;var y=_.clone(i);u[f].push(y)}})}),u}(function(){function e(e){function t(t,n,a,r,i,o){for(;i>=0&&o>i;i+=e){var c=r?r[i]:i;a=n(a,t[c],c,t)}return a}return function(n,a,r,i){a=y(a,i,4);var o=!_(n)&&D.keys(n),c=(o||n).length,l=e>0?0:c-1;return arguments.length<3&&(r=n[o?o[l]:l],l+=e),t(n,a,r,o,l,c)}}function t(e){return function(t,n,a){n=M(n,a);for(var r=T(t),i=e>0?0:r-1;i>=0&&r>i;i+=e)if(n(t[i],i,t))return i;return-1}}function n(e,t,n){return function(a,r,i){var o=0,c=T(a);if("number"==typeof i)e>0?o=i>=0?i:Math.max(i+c,o):c=i>=0?Math.min(i+1,c):i+c+1;else if(n&&i&&c)return i=n(a,r),a[i]===r?i:-1;if(r!==r)return i=t(u.call(a,o,c),D.isNaN),i>=0?i+o:-1;for(i=e>0?o:c-1;i>=0&&c>i;i+=e)if(a[i]===r)return i;return-1}}function a(e,t){var n=$.length,a=e.constructor,r=D.isFunction(a)&&a.prototype||c,i="constructor";for(D.has(e,i)&&!D.contains(t,i)&&t.push(i);n--;)i=$[n],i in e&&e[i]!==r[i]&&!D.contains(t,i)&&t.push(i)}var r=this,i=r._,o=Array.prototype,c=Object.prototype,l=Function.prototype,s=o.push,u=o.slice,p=c.toString,d=c.hasOwnProperty,f=Array.isArray,h=Object.keys,v=l.bind,g=Object.create,m=function(){},D=function(e){return e instanceof D?e:this instanceof D?void(this._wrapped=e):new D(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=D),exports._=D):r._=D,D.VERSION="1.8.3";var y=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,a){return e.call(t,n,a)};case 3:return function(n,a,r){return e.call(t,n,a,r)};case 4:return function(n,a,r,i){return e.call(t,n,a,r,i)}}return function(){return e.apply(t,arguments)}},M=function(e,t,n){return null==e?D.identity:D.isFunction(e)?y(e,t,n):D.isObject(e)?D.matcher(e):D.property(e)};D.iteratee=function(e,t){return M(e,t,1/0)};var w=function(e,t){return function(n){var a=arguments.length;if(2>a||null==n)return n;for(var r=1;a>r;r++)for(var i=arguments[r],o=e(i),c=o.length,l=0;c>l;l++){var s=o[l];t&&void 0!==n[s]||(n[s]=i[s])}return n}},k=function(e){if(!D.isObject(e))return{};if(g)return g(e);m.prototype=e;var t=new m;return m.prototype=null,t},E=function(e){return function(t){return null==t?void 0:t[e]}},b=Math.pow(2,53)-1,T=E("length"),_=function(e){var t=T(e);return"number"==typeof t&&t>=0&&b>=t};D.each=D.forEach=function(e,t,n){t=y(t,n);var a,r;if(_(e))for(a=0,r=e.length;r>a;a++)t(e[a],a,e);else{var i=D.keys(e);for(a=0,r=i.length;r>a;a++)t(e[i[a]],i[a],e)}return e},D.map=D.collect=function(e,t,n){t=M(t,n);for(var a=!_(e)&&D.keys(e),r=(a||e).length,i=Array(r),o=0;r>o;o++){var c=a?a[o]:o;i[o]=t(e[c],c,e)}return i},D.reduce=D.foldl=D.inject=e(1),D.reduceRight=D.foldr=e(-1),D.find=D.detect=function(e,t,n){var a;return a=_(e)?D.findIndex(e,t,n):D.findKey(e,t,n),void 0!==a&&-1!==a?e[a]:void 0},D.filter=D.select=function(e,t,n){var a=[];return t=M(t,n),D.each(e,function(e,n,r){t(e,n,r)&&a.push(e)}),a},D.reject=function(e,t,n){return D.filter(e,D.negate(M(t)),n)},D.every=D.all=function(e,t,n){t=M(t,n);for(var a=!_(e)&&D.keys(e),r=(a||e).length,i=0;r>i;i++){var o=a?a[i]:i;if(!t(e[o],o,e))return!1}return!0},D.some=D.any=function(e,t,n){t=M(t,n);for(var a=!_(e)&&D.keys(e),r=(a||e).length,i=0;r>i;i++){var o=a?a[i]:i;if(t(e[o],o,e))return!0}return!1},D.contains=D.includes=D.include=function(e,t,n,a){return _(e)||(e=D.values(e)),("number"!=typeof n||a)&&(n=0),D.indexOf(e,t,n)>=0},D.invoke=function(e,t){var n=u.call(arguments,2),a=D.isFunction(t);return D.map(e,function(e){var r=a?t:e[t];return null==r?r:r.apply(e,n)})},D.pluck=function(e,t){return D.map(e,D.property(t))},D.where=function(e,t){return D.filter(e,D.matcher(t))},D.findWhere=function(e,t){return D.find(e,D.matcher(t))},D.max=function(e,t,n){var a,r,i=-1/0,o=-1/0;if(null==t&&null!=e){e=_(e)?e:D.values(e);for(var c=0,l=e.length;l>c;c++)a=e[c],a>i&&(i=a)}else t=M(t,n),D.each(e,function(e,n,a){r=t(e,n,a),(r>o||r===-1/0&&i===-1/0)&&(i=e,o=r)});return i},D.min=function(e,t,n){var a,r,i=1/0,o=1/0;if(null==t&&null!=e){e=_(e)?e:D.values(e);for(var c=0,l=e.length;l>c;c++)a=e[c],i>a&&(i=a)}else t=M(t,n),D.each(e,function(e,n,a){r=t(e,n,a),(o>r||1/0===r&&1/0===i)&&(i=e,o=r)});return i},D.shuffle=function(e){for(var t,n=_(e)?e:D.values(e),a=n.length,r=Array(a),i=0;a>i;i++)t=D.random(0,i),t!==i&&(r[i]=r[t]),r[t]=n[i];return r},D.sample=function(e,t,n){return null==t||n?(_(e)||(e=D.values(e)),e[D.random(e.length-1)]):D.shuffle(e).slice(0,Math.max(0,t))},D.sortBy=function(e,t,n){return t=M(t,n),D.pluck(D.map(e,function(e,n,a){return{value:e,index:n,criteria:t(e,n,a)}}).sort(function(e,t){var n=e.criteria,a=t.criteria;if(n!==a){if(n>a||void 0===n)return 1;if(a>n||void 0===a)return-1}return e.index-t.index}),"value")};var P=function(e){return function(t,n,a){var r={};return n=M(n,a),D.each(t,function(a,i){var o=n(a,i,t);e(r,a,o)}),r}};D.groupBy=P(function(e,t,n){D.has(e,n)?e[n].push(t):e[n]=[t]}),D.indexBy=P(function(e,t,n){e[n]=t}),D.countBy=P(function(e,t,n){D.has(e,n)?e[n]++:e[n]=1}),D.toArray=function(e){return e?D.isArray(e)?u.call(e):_(e)?D.map(e,D.identity):D.values(e):[]},D.size=function(e){return null==e?0:_(e)?e.length:D.keys(e).length},D.partition=function(e,t,n){t=M(t,n);var a=[],r=[];return D.each(e,function(e,n,i){(t(e,n,i)?a:r).push(e)}),[a,r]},D.first=D.head=D.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:D.initial(e,e.length-t)},D.initial=function(e,t,n){return u.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},D.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:D.rest(e,Math.max(0,e.length-t))},D.rest=D.tail=D.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},D.compact=function(e){return D.filter(e,D.identity)};var O=function(e,t,n,a){for(var r=[],i=0,o=a||0,c=T(e);c>o;o++){var l=e[o];if(_(l)&&(D.isArray(l)||D.isArguments(l))){t||(l=O(l,t,n));var s=0,u=l.length;for(r.length+=u;u>s;)r[i++]=l[s++]}else n||(r[i++]=l)}return r};D.flatten=function(e,t){return O(e,t,!1)},D.without=function(e){return D.difference(e,u.call(arguments,1))},D.uniq=D.unique=function(e,t,n,a){D.isBoolean(t)||(a=n,n=t,t=!1),null!=n&&(n=M(n,a));for(var r=[],i=[],o=0,c=T(e);c>o;o++){var l=e[o],s=n?n(l,o,e):l;t?(o&&i===s||r.push(l),i=s):n?D.contains(i,s)||(i.push(s),r.push(l)):D.contains(r,l)||r.push(l)}return r},D.union=function(){return D.uniq(O(arguments,!0,!0))},D.intersection=function(e){for(var t=[],n=arguments.length,a=0,r=T(e);r>a;a++){var i=e[a];if(!D.contains(t,i)){for(var o=1;n>o&&D.contains(arguments[o],i);o++);o===n&&t.push(i)}}return t},D.difference=function(e){var t=O(arguments,!0,!0,1);return D.filter(e,function(e){return!D.contains(t,e)})},D.zip=function(){return D.unzip(arguments)},D.unzip=function(e){for(var t=e&&D.max(e,T).length||0,n=Array(t),a=0;t>a;a++)n[a]=D.pluck(e,a);return n},D.object=function(e,t){for(var n={},a=0,r=T(e);r>a;a++)t?n[e[a]]=t[a]:n[e[a][0]]=e[a][1];return n},D.findIndex=t(1),D.findLastIndex=t(-1),D.sortedIndex=function(e,t,n,a){n=M(n,a,1);for(var r=n(t),i=0,o=T(e);o>i;){var c=Math.floor((i+o)/2);n(e[c])<r?i=c+1:o=c}return i},D.indexOf=n(1,D.findIndex,D.sortedIndex),D.lastIndexOf=n(-1,D.findLastIndex),D.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var a=Math.max(Math.ceil((t-e)/n),0),r=Array(a),i=0;a>i;i++,e+=n)r[i]=e;return r};var C=function(e,t,n,a,r){if(!(a instanceof t))return e.apply(n,r);var i=k(e.prototype),o=e.apply(i,r);return D.isObject(o)?o:i};D.bind=function(e,t){if(v&&e.bind===v)return v.apply(e,u.call(arguments,1));if(!D.isFunction(e))throw new TypeError("Bind must be called on a function");var n=u.call(arguments,2),a=function(){return C(e,a,t,this,n.concat(u.call(arguments)))};return a},D.partial=function(e){var t=u.call(arguments,1),n=function(){for(var a=0,r=t.length,i=Array(r),o=0;r>o;o++)i[o]=t[o]===D?arguments[a++]:t[o];for(;a<arguments.length;)i.push(arguments[a++]);return C(e,n,this,this,i)};return n},D.bindAll=function(e){var t,n,a=arguments.length;if(1>=a)throw new Error("bindAll must be passed function names");for(t=1;a>t;t++)n=arguments[t],e[n]=D.bind(e[n],e);return e},D.memoize=function(e,t){var n=function(a){var r=n.cache,i=""+(t?t.apply(this,arguments):a);return D.has(r,i)||(r[i]=e.apply(this,arguments)),r[i]};return n.cache={},n},D.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},D.defer=D.partial(D.delay,D,1),D.throttle=function(e,t,n){var a,r,i,o=null,c=0;n||(n={});var l=function(){c=n.leading===!1?0:D.now(),o=null,i=e.apply(a,r),o||(a=r=null)};return function(){var s=D.now();c||n.leading!==!1||(c=s);var u=t-(s-c);return a=this,r=arguments,0>=u||u>t?(o&&(clearTimeout(o),o=null),c=s,i=e.apply(a,r),o||(a=r=null)):o||n.trailing===!1||(o=setTimeout(l,u)),i}},D.debounce=function(e,t,n){var a,r,i,o,c,l=function(){var s=D.now()-o;t>s&&s>=0?a=setTimeout(l,t-s):(a=null,n||(c=e.apply(i,r),a||(i=r=null)))};return function(){i=this,r=arguments,o=D.now();var s=n&&!a;return a||(a=setTimeout(l,t)),s&&(c=e.apply(i,r),i=r=null),c}},D.wrap=function(e,t){return D.partial(t,e)},D.negate=function(e){return function(){return!e.apply(this,arguments)}},D.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,a=e[t].apply(this,arguments);n--;)a=e[n].call(this,a);return a}},D.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},D.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),1>=e&&(t=null),n}},D.once=D.partial(D.before,2);var I=!{toString:null}.propertyIsEnumerable("toString"),$=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];D.keys=function(e){if(!D.isObject(e))return[];if(h)return h(e);var t=[];for(var n in e)D.has(e,n)&&t.push(n);return I&&a(e,t),t},D.allKeys=function(e){if(!D.isObject(e))return[];var t=[];for(var n in e)t.push(n);return I&&a(e,t),t},D.values=function(e){for(var t=D.keys(e),n=t.length,a=Array(n),r=0;n>r;r++)a[r]=e[t[r]];return a},D.mapObject=function(e,t,n){t=M(t,n);for(var a,r=D.keys(e),i=r.length,o={},c=0;i>c;c++)a=r[c],o[a]=t(e[a],a,e);return o},D.pairs=function(e){for(var t=D.keys(e),n=t.length,a=Array(n),r=0;n>r;r++)a[r]=[t[r],e[t[r]]];return a},D.invert=function(e){for(var t={},n=D.keys(e),a=0,r=n.length;r>a;a++)t[e[n[a]]]=n[a];return t},D.functions=D.methods=function(e){var t=[];for(var n in e)D.isFunction(e[n])&&t.push(n);return t.sort()},D.extend=w(D.allKeys),D.extendOwn=D.assign=w(D.keys),D.findKey=function(e,t,n){t=M(t,n);for(var a,r=D.keys(e),i=0,o=r.length;o>i;i++)if(a=r[i],t(e[a],a,e))return a},D.pick=function(e,t,n){var a,r,i={},o=e;if(null==o)return i;D.isFunction(t)?(r=D.allKeys(o),a=y(t,n)):(r=O(arguments,!1,!1,1),a=function(e,t,n){return t in n},o=Object(o));for(var c=0,l=r.length;l>c;c++){var s=r[c],u=o[s];a(u,s,o)&&(i[s]=u)}return i},D.omit=function(e,t,n){if(D.isFunction(t))t=D.negate(t);else{var a=D.map(O(arguments,!1,!1,1),String);t=function(e,t){return!D.contains(a,t)}}return D.pick(e,t,n)},D.defaults=w(D.allKeys,!0),D.create=function(e,t){var n=k(e);return t&&D.extendOwn(n,t),n},D.clone=function(e){return D.isObject(e)?D.isArray(e)?e.slice():D.extend({},e):e},D.tap=function(e,t){return t(e),e},D.isMatch=function(e,t){var n=D.keys(t),a=n.length;if(null==e)return!a;for(var r=Object(e),i=0;a>i;i++){var o=n[i];if(t[o]!==r[o]||!(o in r))return!1}return!0};var F=function(e,t,n,a){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof D&&(e=e._wrapped),t instanceof D&&(t=t._wrapped);var r=p.call(e);if(r!==p.call(t))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var i="[object Array]"===r;if(!i){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,c=t.constructor;if(o!==c&&!(D.isFunction(o)&&o instanceof o&&D.isFunction(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],a=a||[];for(var l=n.length;l--;)if(n[l]===e)return a[l]===t;if(n.push(e),a.push(t),i){if(l=e.length,l!==t.length)return!1;for(;l--;)if(!F(e[l],t[l],n,a))return!1}else{var s,u=D.keys(e);if(l=u.length,D.keys(t).length!==l)return!1;for(;l--;)if(s=u[l],!D.has(t,s)||!F(e[s],t[s],n,a))return!1}return n.pop(),a.pop(),!0};D.isEqual=function(e,t){return F(e,t)},D.isEmpty=function(e){return null==e?!0:_(e)&&(D.isArray(e)||D.isString(e)||D.isArguments(e))?0===e.length:0===D.keys(e).length},D.isElement=function(e){return!(!e||1!==e.nodeType)},D.isArray=f||function(e){return"[object Array]"===p.call(e)},D.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},D.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){D["is"+e]=function(t){return p.call(t)==="[object "+e+"]"}}),D.isArguments(arguments)||(D.isArguments=function(e){return D.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(D.isFunction=function(e){return"function"==typeof e||!1}),D.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},D.isNaN=function(e){return D.isNumber(e)&&e!==+e},D.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===p.call(e)},D.isNull=function(e){return null===e},D.isUndefined=function(e){return void 0===e},D.has=function(e,t){return null!=e&&d.call(e,t)},D.noConflict=function(){return r._=i,this},D.identity=function(e){return e},D.constant=function(e){return function(){return e}},D.noop=function(){},D.property=E,D.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},D.matcher=D.matches=function(e){return e=D.extendOwn({},e),function(t){return D.isMatch(t,e)}},D.times=function(e,t,n){var a=Array(Math.max(0,e));t=y(t,n,1);for(var r=0;e>r;r++)a[r]=t(r);return a},D.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},D.now=Date.now||function(){return(new Date).getTime()};var L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=D.invert(L),A=function(e){var t=function(t){return e[t]},n="(?:"+D.keys(e).join("|")+")",a=RegExp(n),r=RegExp(n,"g");return function(e){return e=null==e?"":""+e,a.test(e)?e.replace(r,t):e}};D.escape=A(L),D.unescape=A(N),D.result=function(e,t,n){var a=null==e?void 0:e[t];return void 0===a&&(a=n),D.isFunction(a)?a.call(e):a};var x=0;D.uniqueId=function(e){
var t=++x+"";return e?e+t:t},D.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var V=/(.)^/,U={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Y=/\\|'|\r|\n|\u2028|\u2029/g,S=function(e){return"\\"+U[e]};D.template=function(e,t,n){!t&&n&&(t=n),t=D.defaults({},t,D.templateSettings);var a=RegExp([(t.escape||V).source,(t.interpolate||V).source,(t.evaluate||V).source].join("|")+"|$","g"),r=0,i="__p+='";e.replace(a,function(t,n,a,o,c){return i+=e.slice(r,c).replace(Y,S),r=c+t.length,n?i+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":a?i+="'+\n((__t=("+a+"))==null?'':__t)+\n'":o&&(i+="';\n"+o+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var o=new Function(t.variable||"obj","_",i)}catch(c){throw c.source=i,c}var l=function(e){return o.call(this,e,D)},s=t.variable||"obj";return l.source="function("+s+"){\n"+i+"}",l},D.chain=function(e){var t=D(e);return t._chain=!0,t};var H=function(e,t){return e._chain?D(t).chain():t};D.mixin=function(e){D.each(D.functions(e),function(t){var n=D[t]=e[t];D.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),H(this,n.apply(D,e))}})},D.mixin(D),D.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=o[e];D.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],H(this,n)}}),D.each(["concat","join","slice"],function(e){var t=o[e];D.prototype[e]=function(){return H(this,t.apply(this._wrapped,arguments))}}),D.prototype.value=function(){return this._wrapped},D.prototype.valueOf=D.prototype.toJSON=D.prototype.value,D.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return D})}).call(this);var d,f=JSON.parse(e);"month"==f.process?d=p(f.evts,f.rws):"day"==f.process&&(d=u(f.evts,f.rws)),t.resolve(JSON.stringify(d))}])),this.step={months:1},this.element=n,this.init=function(t){angular.extend(t,this),e.showWeeks=t.showWeeks||!0,t.refreshView()};var w=this;this.initForAllMonthsHeatData=function(t){w._actMonViewDate=e.monthDate,w.activeMonthViewDate=e.monthDate.date,angular.extend(this,t),w._refreshMonthView(!0)},this.initForAllMonthsEventsData=function(t){w._actMonViewDate=e.monthDate,w.activeMonthViewDate=e.monthDate.date,angular.extend(this,t),w._refreshMonthView(!1)},e.$on("refreshMonth",function(t,n){e.monthDate.date.setFullYear(n.date.getFullYear()),w._actMonViewDate=e.monthDate,w.activeMonthViewDate=e.monthDate.date,w._refreshMonthView(!1)}),e.richccDaySelected=function(t,n){var a={dt:t,events:n};"function"==typeof e.daySelectCallback?e.daySelectCallback({data:a}):"function"==typeof e.$parent.daySelectCallback&&e.$parent.daySelectCallback({data:a})},e.richccDaySelectedKeyUp=function(t,n,a){(32==t.keyCode||13==t.keyCode)&&e.richccDaySelected(n,a)},e.popUpTriggered=function(e){t(function(){var t=document.getElementById("popup_"+e);t&&$(t).focus()},50)},e.popUpKeyUp=function(n,a){27==n.keyCode&&t(function(){var t=document.getElementById("empSpan_"+e.datePickerUID);if(t){$(t).trigger("click");var n=document.getElementById("tb"+e.datePickerUID);n&&$(n).focus()}},50)},e.popUpTrigger=function(t){try{var n=e.eventPopupSettings;if("undefined"==typeof n||"undefined"==typeof n.showWhenEventsEmpty||1==n.showWhenEventsEmpty)return"undefined"!=typeof n&&"undefined"!=typeof n.showWhenEventsEmpty&&1==n.showWhenEventsEmpty?"outsideClick":"none";if("undefined"==typeof t||null==t||t=={})return"none";if(t.length>0&&1!=n.hidden)return"outsideClick"}catch(a){return"none"}},e.popUpTriggerYearView=function(t){try{var n=e.parent.eventPopupSettings;if("undefined"==typeof n||"undefined"==typeof n.showWhenEventsEmpty||1==n.showWhenEventsEmpty)return"undefined"!=typeof n&&"undefined"!=typeof n.showWhenEventsEmpty&&1==n.showWhenEventsEmpty?"outsideClick":"none";if("undefined"==typeof t||null==t||t=={})return"none";if(t.length>0&&1!=n.hidden)return"outsideClick"}catch(a){return"none"}},e.popUpLeftHandler=function(t,n){var a={dt:t,events:n};"function"==typeof e.eventPopupLeftCallback?e.eventPopupLeftCallback({data:a}):"function"==typeof e.$parent.eventPopupLeftCallback&&e.$parent.eventPopupLeftCallback({data:a})},e.popUpRightHandler=function(t,n){var a={dt:t,events:n};"function"==typeof e.eventPopupRightCallback?e.eventPopupRightCallback({data:a}):"function"==typeof e.$parent.eventPopupRightCallback&&e.$parent.eventPopupRightCallback({data:a})},e.popUpEventClickHandler=function(t,n){var a={dt:t,event:n};"function"==typeof e.eventClickCallback?e.eventClickCallback({data:a}):"function"==typeof e.$parent.eventClickCallback&&e.$parent.eventClickCallback({data:a})},e.popUpEventKeyUpHandler=function(t,n,a){(32==a.keyCode||13==a.keyCode)&&e.popUpEventClickHandler(t,n)},this.getDates=function(e,t){for(var n,a=new Array(t),r=new Date(e),i=0;t>i;)n=new Date(r),a[i++]=n,r.setDate(r.getDate()+1);return a},this._refreshView=function(){e.eventDetails={};var t=this.activeDate.getFullYear(),n=this.activeDate.getMonth(),r=new Date(this.activeDate);r.setFullYear(t,n,1);var i=this.startingDay-r.getDay(),o=i>0?7-i:-i,l=new Date(r);o>0&&l.setDate(-o+1);for(var s=this.getDates(l,42),u=["January","February","March","April","May","June","July","August","September","October","November","December"],p=0;42>p;p++)s[p]=angular.extend(this.createDateObject(s[p],this.formatDay),{secondary:s[p].getMonth()!==n,uid:e.uniqueId+"-"+s[p].getFullYear()+"_"+s[p].getMonth()+"_"+s[p].getDate(),dtAriaLabel:u[s[p].getMonth()]+" "+s[p].getDate()+" "+s[p].getFullYear(),key:s[p].getFullYear()+"_"+s[p].getMonth()+"_"+s[p].getDate()});e.labels=new Array(7);for(var d=0;7>d;d++)e.labels[d]={abbr:a(s[d].date,this.formatDayHeader),full:a(s[d].date,"EEEE")};if(e.title=a(this.activeDate,this.formatDayTitle),e.rows=this.split(s,7),e.showWeeks){e.weekNumbers=[];for(var f=(11-this.startingDay)%7,h=e.rows.length,v=0;h>v;v++)e.weekNumbers.push(c(e.rows[v][f].date))}if(1==this.showDataLabel&&(e.dataLabels=this.processLabels(this._dayLabels)),M){var g=this._events;D.then(function(t){var n={evts:g,rws:e.rows,process:"day"};return t.run(JSON.stringify(n))},function(e){}).then(function(t){var n=JSON.parse(t);e.eventDetails=n})}else e.eventDetails=this.processEvents(this._events,e.rows);e.light=this.light,e.yearMapHeat=this.yearMapHeat,e.enableWebWorkers=this.enableWebWorkers,e.expandedMode=this.expandedMode,e.eventPopupHide=this.eventPopupHide,e.preventCalNav=this.preventCalNav,e.stopHighlight=this.stopHighlight,e.preventModeToggle=this.preventModeToggle,e.monthPopUpTmpl=this.monthPopUpTmpl,e.dayPopUpTmpl=this.dayPopUpTmpl},this.compare=function(e,t){var n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(t.getFullYear(),t.getMonth(),t.getDate());return n.setFullYear(e.getFullYear()),a.setFullYear(t.getFullYear()),n-a},this.handleKeyDown=function(e,t){var n=this.activeDate.getDate();if("left"===e)n-=1;else if("up"===e)n-=7;else if("right"===e)n+=1;else if("down"===e)n+=7;else if("pageup"===e||"pagedown"===e){var a=this.activeDate.getMonth()+("pageup"===e?-1:1);this.activeDate.setMonth(a,1),n=Math.min(o(this.activeDate.getFullYear(),this.activeDate.getMonth()),n)}else"home"===e?n=1:"end"===e&&(n=o(this.activeDate.getFullYear(),this.activeDate.getMonth()));this.activeDate.setDate(n)},this.processEvents=function(t,n){var a=_.map(n,function(e){var t=e[0];return t._date=t.date.setHours(0,0,0,0),t}),r=_.map(t,function(e){return e._startDt=new Date(e.startDt).setHours(0,0,0,0),e._endDt=new Date(e.endDt).setHours(0,0,0,0),e.startDtFQ||(e.startDtFQ=e._startDt),e.endDtFQ||(e.endDtFQ=e._endDt),e}),i=r.sort(function(e,t){return e._startDt==t._startDt?l(e._endDt,t._endDt):l(e._startDt,t._startDt)}),o={},c=1;return _.each(i,function(t){var r=s(t._startDt,t._endDt),i={};angular.extend(i,t),i.order=null,i.first=null,_.each(r,function(t,l){var s=f(t,n);if(1==s){var u=t.getFullYear()+"_"+t.getMonth()+"_"+t.getDate();("undefined"==typeof o[u]||null==o[u])&&(o[u]=[]);var h=i.order;0==l&&(i.order=p(o[u])),1==d(t,a)&&(i.order=p(o[u]));var v=i.order;1!=e.expandedMode?(h!=v&&2>=v?i.startPaint=i.startPaintForMonth=!0:i.startPaint=i.startPaintForMonth=!1,1==d(t,a)&&2>=v&&(i.startPaint=!0)):(h!=v?i.startPaint=i.startPaintForMonth=!0:i.startPaint=i.startPaintForMonth=!1,1==d(t,a)&&(i.startPaint=!0)),i.paintBoxLength=Math.min(7-t.getDay(),r.length-l),i.paintBoxLengthForMonth=r.length,1==i.startPaint&&(i.step=c,c+=1);var g=_.clone(i);o[u].push(g)}})}),o},this.processEventsForMonthEventViewer=function(e,t){var n=_.map(e,function(e){return e._startDt=new Date(e.startDt).setHours(0,0,0,0),e._endDt=new Date(e.endDt).setHours(0,0,0,0),e.startDtFQ||(e.startDtFQ=e._startDt),e.endDtFQ||(e.endDtFQ=e._endDt),e}),a=n.sort(function(e,t){return e._startDt==t._startDt?l(e._endDt,t._endDt):l(e._startDt,t._startDt)}),r={},i={};return _.each(a,function(e){var n=s(e._startDt,e._endDt),a={};angular.extend(a,e),a.order=null,a.first=null,_.each(n,function(o,c){var l=h(o,t);if(1==l){var s=o.getFullYear()+"_"+o.getMonth()+"_"+o.getDate();("undefined"==typeof r[s]||null==r[s])&&(r[s]=[]);var p=a.id+"_"+o.getMonth();if(1!=i[p]){var d=a.order;a.order=u(r[s]);var f=a.order;if(d!=f&&2>=f){a.startPaintForMonth=!0;var m=v(n,t);a.paintBoxLengthForMonth=g(m,o,new Date(e._startDt)),i[p]=!0}else a.startPaintForMonth=!1}else a.startPaintForMonth=!1;var D=_.clone(a);r[s].push(D)}})}),r},this.processLabels=function(e){var t={};return _.each(e,function(e){var n=new Date(e.dt),a=n.getFullYear()+"_"+n.getMonth()+"_"+n.getDate();t[a]=e.label}),t},e.viewAllEvents=function(e,t){return t.stopPropagation(),t.preventDefault(),!1},e.getPopUpPositionForDayMap=function(e,t){var n="";return n=2>=e?"bottom":"top",0==t?n+="-left":6==t&&(n+="-right"),n},e.getPopUpPositionForMonthHeatMap=function(e){var t="";switch(e){case 0:case 1:t="bottom-left";break;case 6:case 7:t="top-left";break;case 4:case 5:t="bottom-right";break;case 10:case 11:t="top-right";break;case 8:case 9:t="top";break;case 2:case 3:default:t="bottom"}return t},e.getPopUpPositionForMonthEventMap=function(e,t){var n="";switch(n=6>e?"bottom":"top",t){case 0:case 1:n+="-left";break;case 5:case 6:n+="-right";break;default:n=n}return n},this._refreshMonthView=function(t){this._events=e.$parent.events,1==t&&this.activeMonthViewDate.setDate(15);var n=this.activeMonthViewDate.getFullYear(),r=this.activeMonthViewDate.getMonth(),i=new Date(this.activeMonthViewDate);"undefined"!=typeof e.monthWiseEventDetails?e.monthWiseEventDetails[this.activeMonthViewDate.getMonth()]={}:"undefined"!=typeof e.parent.monthWiseEventDetails&&(e.parent.monthWiseEventDetails[this.activeMonthViewDate.getMonth()]={}),i.setFullYear(n,r,1),this.startingDay=0;var o=this.startingDay-i.getDay(),l=o>0?7-o:-o,s=new Date(i);l>0&&s.setDate(-l+1);for(var u=this.getDates(s,42),p=0;42>p;p++)u[p]=angular.extend(m(u[p],this.formatDay),{secondary:u[p].getMonth()!==r,uid:e.uniqueId+"-"+p,key:u[p].getFullYear()+"_"+u[p].getMonth()+"_"+u[p].getDate(),monthIndex:u[p].getMonth()}),"undefined"!=typeof e.customClass&&"function"==typeof e.customClass?u[p].customClass=e.customClass({date:u[p].date,mode:"year"})||null:"undefined"!=typeof e.datepickerOptions&&"undefined"!=typeof e.datepickerOptions.customClass&&"function"==typeof e.datepickerOptions.customClass?u[p].customClass=e.datepickerOptions.customClass({date:u[p].date,mode:"year"})||null:"undefined"!=typeof e.$parent.datepickerOptions&&"undefined"!=typeof e.$parent.datepickerOptions.customClass&&"function"==typeof e.$parent.datepickerOptions.customClass&&(u[p].customClass=e.$parent.datepickerOptions.customClass({date:u[p].date,mode:"year"})||null),"undefined"!=typeof e.customAriaLabel&&"function"==typeof e.customAriaLabel?u[p].customAriaLabel=e.customAriaLabel({date:u[p].date,mode:"year"})||null:"undefined"!=typeof e.datepickerOptions&&"undefined"!=typeof e.datepickerOptions.customAriaLabel&&"function"==typeof e.datepickerOptions.customAriaLabel?u[p].customAriaLabel=e.datepickerOptions.customAriaLabel({date:u[p].date,mode:"year"})||null:"undefined"!=typeof e.$parent.datepickerOptions&&"undefined"!=typeof e.$parent.datepickerOptions.customAriaLabel&&"function"==typeof e.$parent.datepickerOptions.customAriaLabel&&(u[p].customAriaLabel=e.$parent.datepickerOptions.customAriaLabel({date:u[p].date,mode:"year"})||null);e.labels=new Array(7),this.labels=[];for(var d=0;7>d;d++){var f={abbr:a(u[d].date,this.formatDayHeader),full:a(u[d].date,"EEEE")};this.labels.push(f),e.labels[d]=f}if("undefined"!=typeof e.monthWiseEventMarkers?e.monthWiseEventMarkers[this.activeMonthViewDate.getMonth()]=this.labels:"undefined"!=typeof e.$parent.monthWiseEventMarkers&&(e.$parent.monthWiseEventMarkers[this.activeMonthViewDate.getMonth()]=this.labels),e.title=a(this.activeMonthViewDate,this.formatDayTitle),e.rows=this.split(u,7),"undefined"!=typeof e.monthViewData?e.monthViewData[this.activeMonthViewDate.getMonth()]={dt:this._actMonViewDate,rows:e.rows}:"undefined"!=typeof e.$parent.monthViewData&&(e.$parent.monthViewData[this.activeMonthViewDate.getMonth()]={dt:this._actMonViewDate,rows:e.rows}),e.showWeeks){e.weekNumbers=[];for(var h=(11-this.startingDay)%7,v=e.rows.length,g=0;v>g;g++)e.weekNumbers.push(c(e.rows[g][h].date))}var y=this.activeMonthViewDate.getMonth();if(M){var w=this._events;D.then(function(t){var n={evts:w,rws:e.rows,process:"month"};return t.run(JSON.stringify(n))},function(e){}).then(function(t){var n=JSON.parse(t);this.yearMapHeat?"undefined"!=typeof e.monthViewData?e.monthWiseEventDetails[y]=n:"undefined"!=typeof e.$parent.monthViewData&&(e.$parent.monthWiseEventDetails[y]=n):"undefined"!=typeof e.monthViewData?e.monthWiseEventDetails[y]=n:"undefined"!=typeof e.$parent.monthViewData&&(e.$parent.monthWiseEventDetails[y]=n)})}else this.yearMapHeat?"undefined"!=typeof e.monthViewData?e.monthWiseEventDetails[this.activeMonthViewDate.getMonth()]=this.processEvents(this._events,e.rows):"undefined"!=typeof e.parent.monthViewData&&(e.parent.monthWiseEventDetails[this.activeMonthViewDate.getMonth()]=this.processEvents(this._events,e.rows)):"undefined"!=typeof e.monthViewData?e.monthWiseEventDetails[this.activeMonthViewDate.getMonth()]=this.processEventsForMonthEventViewer(this._events,e.rows):"undefined"!=typeof e.parent.monthViewData&&(e.parent.monthWiseEventDetails[this.activeMonthViewDate.getMonth()]=this.processEventsForMonthEventViewer(this._events,e.rows));e.light=this.light,e.yearMapHeat=this.yearMapHeat,e.enableWebWorkers=this.enableWebWorkers,e.expandedMode=this.expandedMode,e.eventPopupHide=this.eventPopupHide,e.preventCalNav=this.preventCalNav,e.preventModeToggle=this.preventModeToggle,e.monthPopUpTmpl=this.monthPopUpTmpl,e.dayPopUpTmpl=this.dayPopUpTmpl}}]).controller("RichccMonthpickerController",["$scope","$element","dateFilter",function(e,t,n){this.step={years:1},this.element=t,this.init=function(e){angular.extend(e,this),e.refreshView()},this._refreshView=function(){for(var t,a=new Array(12),r=this.activeDate.getFullYear(),i=0;12>i;i++)t=new Date(this.activeDate),t.setFullYear(r,i,1),a[i]=angular.extend(this.createDateObject(t,this.formatMonth),{uid:e.uniqueId+"-"+i,monthIndex:t.getMonth()});e.title=n(this.activeDate,this.formatMonthTitle);var o=1==e.yearMapHeat?6:1;e.rows=this.split(a,o)},this.compare=function(e,t){var n=new Date(e.getFullYear(),e.getMonth()),a=new Date(t.getFullYear(),t.getMonth());return n.setFullYear(e.getFullYear()),a.setFullYear(t.getFullYear()),n-a},this.handleKeyDown=function(e,t){var n=this.activeDate.getMonth();if("left"===e)n-=1;else if("up"===e)n-=3;else if("right"===e)n+=1;else if("down"===e)n+=3;else if("pageup"===e||"pagedown"===e){var a=this.activeDate.getFullYear()+("pageup"===e?-1:1);this.activeDate.setFullYear(a)}else"home"===e?n=0:"end"===e&&(n=11);this.activeDate.setMonth(n)}}]).controller("RichccYearpickerController",["$scope","$element","dateFilter",function(e,t,n){function a(e){return parseInt((e-1)/i,10)*i+1}var r,i;this.element=t,this.yearpickerInit=function(){r=this.yearColumns,i=this.yearRows*r,this.step={years:i}},this._refreshView=function(){for(var t,n=new Array(i),o=0,c=a(this.activeDate.getFullYear());i>o;o++)t=new Date(this.activeDate),t.setFullYear(c+o,0,1),n[o]=angular.extend(this.createDateObject(t,this.formatYear),{uid:e.uniqueId+"-"+o});e.title=[n[0].label,n[i-1].label].join(" - "),e.rows=this.split(n,r),e.columns=r},this.compare=function(e,t){return e.getFullYear()-t.getFullYear()},this.handleKeyDown=function(e,t){var n=this.activeDate.getFullYear();"left"===e?n-=1:"up"===e?n-=r:"right"===e?n+=1:"down"===e?n+=r:"pageup"===e||"pagedown"===e?n+=("pageup"===e?-1:1)*i:"home"===e?n=a(this.activeDate.getFullYear()):"end"===e&&(n=a(this.activeDate.getFullYear())+i-1),this.activeDate.setFullYear(n)}}]).directive("richccDatepicker",function(){return{replace:!0,templateUrl:function(e,t){return t.templateUrl||"template/richcc/datepicker.html"},scope:{datepickerMode:"=?",datepickerOptions:"=?",dateDisabled:"&",customClass:"&",customIconClass:"&",shortcutPropagation:"&?",events:"=",dayLabels:"=",light:"=",eventPopupHide:"=",preventCalNav:"=",preventModeToggle:"=",yearMapHeat:"=",daySelectCallback:"&",eventPopupLeftCallback:"&",eventPopupRightCallback:"&",eventClickCallback:"&",eventPopupSettings:"="},require:["richccDatepicker","^ngModel"],controller:"RichccDatepickerController",controllerAs:"datepicker",link:function(e,t,n,a){var r=a[0],i=a[1];r.init(i)}}}).directive("richccDaypicker",function(){return{replace:!0,templateUrl:function(e,t){return t.templateUrl||"template/richcc/day.html"},require:["^richccDatepicker","richccDaypicker"],controller:"RichccDaypickerController",link:function(e,t,n,a){var r=a[0],i=a[1];i.init(r)}}}).directive("richMonthsHeatViewer",function(){return{replace:!0,templateUrl:function(e,t){return t.templateUrl||"template/richcc/monthHeatViewer.html"},transclude:!0,scope:{monthDate:"=",monthIndex:"=",monthSelectCallback:"&"},require:["^richccDatepicker","^richccMonthpickerHeatmap","richMonthsHeatViewer"],controller:"RichccDaypickerController",link:function(e,t,n,a){var r=a[0],i=(a[1],a[2]);i.initForAllMonthsHeatData(r)}}}).directive("richMonthsEventViewer",function(){return{replace:!0,templateUrl:function(e,t){return t.templateUrl||"template/richcc/monthEventViewer.html"},transclude:!0,scope:{monthDate:"=",monthIndex:"=",monthSelectCallback:"&"},require:["^richccDatepicker","^richccMonthpickerEventmap","richMonthsEventViewer"],controller:"RichccDaypickerController",link:function(e,t,n,a){var r=a[0],i=(a[1],a[2]);i.initForAllMonthsEventsData(r)}}}).directive("richMonthsDayMarker",function(){return{replace:!0,templateUrl:function(e,t){return t.templateUrl||"template/richcc/monthViewerDayMarker.html"}}}).directive("richccMonthpickerHeatmap",function(){return{replace:!0,templateUrl:function(e,t){return t.templateUrl||"template/richcc/monthHeatWrap.html"},require:["^richccDatepicker","richccMonthpickerHeatmap"],controller:"RichccMonthpickerController",link:function(e,t,n,a){var r=a[0],i=a[1];i.init(r)}}}).directive("richccMonthpickerEventmap",function(){return{replace:!0,templateUrl:function(e,t){return t.templateUrl||"template/richcc/monthEventWrap.html"},require:["^richccDatepicker","richccMonthpickerEventmap"],controller:"RichccMonthpickerController",link:function(e,t,n,a){var r=a[0],i=a[1];i.init(r)}}}).directive("richccYearpicker",function(){return{replace:!0,templateUrl:function(e,t){return t.templateUrl||"template/richcc/year.html"},require:["^richccDatepicker","richccYearpicker"],controller:"RichccYearpickerController",link:function(e,t,n,a){var r=a[0];angular.extend(r,a[1]),r.yearpickerInit(),r.refreshView()}}}).constant("richccDatepickerPopupConfig",{altInputFormats:[],appendToBody:!1,clearText:"Clear",closeOnDateSelection:!0,closeText:"Done",currentText:"Today",datepickerPopup:"yyyy-MM-dd",datepickerPopupTemplateUrl:"template/richcc/popup.html",datepickerTemplateUrl:"template/richcc/datepicker.html",html5Types:{date:"yyyy-MM-dd","datetime-local":"yyyy-MM-ddTHH:mm:ss.sss",month:"yyyy-MM"},onOpenFocus:!0,showButtonBar:!0}).controller("RichccDatepickerPopupController",["$scope","$element","$attrs","$compile","$parse","$document","$rootScope","$uibPosition","dateFilter","uibDateParser","richccDatepickerPopupConfig","$timeout","richccDatepickerConfig",function(e,t,n,a,r,i,o,c,l,s,u,p,d){function f(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function h(t){var n=s.parse(t,y,e.date);if(isNaN(n))for(var a=0;a<I.length;a++)if(n=s.parse(t,I[a],e.date),!isNaN(n))return n;return n}function v(e){if(angular.isNumber(e)&&(e=new Date(e)),!e)return null;if(angular.isDate(e)&&!isNaN(e))return e;if(angular.isString(e)){var t=h(e);if(!isNaN(t))return s.toTimezone(t,O.timezone)}return P.$options&&P.$options.allowInvalid?e:void 0}function g(e,t){var a=e||t;return n.ngRequired||a?(angular.isNumber(a)&&(a=new Date(a)),a?angular.isDate(a)&&!isNaN(a)?!0:angular.isString(a)?!isNaN(h(t)):!1:!0):!0}function m(n){if(e.isOpen||!e.disabled){var a=C[0],r=t[0].contains(n.target),i=void 0!==a.contains&&a.contains(n.target);!e.isOpen||r||i||e.$apply(function(){e.isOpen=!1})}}function D(n){27===n.which&&e.isOpen?(n.preventDefault(),n.stopPropagation(),e.$apply(function(){e.isOpen=!1}),t[0].focus()):40!==n.which||e.isOpen||(n.preventDefault(),n.stopPropagation(),e.$apply(function(){e.isOpen=!0}))}var y,M,w,k,E,b,T,_,P,O,C,I,$={},F=!1,L=[];e.watchData={},this.init=function(c){if(P=c,O=c.$options||d.ngModelOptions,M=angular.isDefined(n.closeOnDateSelection)?e.$parent.$eval(n.closeOnDateSelection):u.closeOnDateSelection,w=angular.isDefined(n.datepickerAppendToBody)?e.$parent.$eval(n.datepickerAppendToBody):u.appendToBody,k=angular.isDefined(n.onOpenFocus)?e.$parent.$eval(n.onOpenFocus):u.onOpenFocus,E=angular.isDefined(n.datepickerPopupTemplateUrl)?n.datepickerPopupTemplateUrl:u.datepickerPopupTemplateUrl,b=angular.isDefined(n.datepickerTemplateUrl)?n.datepickerTemplateUrl:u.datepickerTemplateUrl,I=angular.isDefined(n.altInputFormats)?e.$parent.$eval(n.altInputFormats):u.altInputFormats,e.showButtonBar=angular.isDefined(n.showButtonBar)?e.$parent.$eval(n.showButtonBar):u.showButtonBar,u.html5Types[n.type]?(y=u.html5Types[n.type],F=!0):(y=n.uibDatepickerPopup||u.datepickerPopup,n.$observe("uibDatepickerPopup",function(e,t){var n=e||u.datepickerPopup;if(n!==y&&(y=n,P.$modelValue=null,!y))throw new Error("uibDatepickerPopup must have a date format specified.")})),!y)throw new Error("uibDatepickerPopup must have a date format specified.");if(F&&n.uibDatepickerPopup)throw new Error("HTML5 date input types do not support custom formats.");T=angular.element("<div uib-datepicker-popup-wrap><div uib-datepicker></div></div>"),e.ngModelOptions=angular.copy(O),e.ngModelOptions.timezone=null,T.attr({"ng-model":"date","ng-model-options":"ngModelOptions","ng-change":"dateSelection(date)","template-url":E}),_=angular.element(T.children()[0]),_.attr("template-url",b),F&&"month"===n.type&&(_.attr("datepicker-mode",'"month"'),_.attr("min-mode","month")),e.datepickerOptions&&angular.forEach(e.datepickerOptions,function(e,t){-1===["minDate","maxDate","minMode","maxMode","initDate","datepickerMode"].indexOf(t)?_.attr(f(t),e):_.attr(f(t),"datepickerOptions."+t)}),angular.forEach(["minMode","maxMode","datepickerMode","shortcutPropagation"],function(t){if(n[t]){var a=r(n[t]),i={get:function(){return a(e.$parent)}};if(_.attr(f(t),"watchData."+t),"datepickerMode"===t){var o=a.assign;i.set=function(t){o(e.$parent,t)}}Object.defineProperty(e.watchData,t,i)}}),angular.forEach(["minDate","maxDate","initDate"],function(t){if(n[t]){var a=r(n[t]);L.push(e.$parent.$watch(a,function(n){"minDate"===t||"maxDate"===t?(null===n?$[t]=null:angular.isDate(n)?$[t]=s.fromTimezone(new Date(n),O.timezone):$[t]=new Date(l(n,"medium")),e.watchData[t]=null===n?null:$[t]):e.watchData[t]=s.fromTimezone(new Date(n),O.timezone)})),_.attr(f(t),"watchData."+t)}}),n.dateDisabled&&_.attr("date-disabled","dateDisabled({ date: date, mode: mode })"),angular.forEach(["formatDay","formatMonth","formatYear","formatDayHeader","formatDayTitle","formatMonthTitle","showWeeks","startingDay","yearRows","yearColumns"],function(e){angular.isDefined(n[e])&&_.attr(f(e),n[e])}),n.customClass&&_.attr("custom-class","customClass({ date: date, mode: mode })"),n.customIconClass&&_.attr("custom-class","customIconClass({ date: date, mode: mode })"),F?P.$formatters.push(function(t){return e.date=s.fromTimezone(t,O.timezone),t}):(P.$$parserName="date",P.$validators.date=g,P.$parsers.unshift(v),P.$formatters.push(function(t){return P.$isEmpty(t)?(e.date=t,t):(e.date=s.fromTimezone(t,O.timezone),y=y.replace(/M!/,"MM").replace(/d!/,"dd"),l(e.date,y))})),P.$viewChangeListeners.push(function(){e.date=h(P.$viewValue)}),t.on("keydown",D),C=a(T)(e),T.remove(),w?i.find("body").append(C):t.after(C),e.$on("$destroy",function(){for(e.isOpen===!0&&(o.$$phase||e.$$phase||e.$apply(function(){e.isOpen=!1})),C.remove(),t.off("keydown",D),i.off("click",m);L.length;)L.shift()()})},e.getText=function(t){return e[t+"Text"]||u[t+"Text"]},e.isDisabled=function(t){return"today"===t&&(t=new Date),e.watchData.minDate&&e.compare(t,$.minDate)<0||e.watchData.maxDate&&e.compare(t,$.maxDate)>0},e.compare=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate())-new Date(t.getFullYear(),t.getMonth(),t.getDate())},e.dateSelection=function(n){angular.isDefined(n)&&(e.date=n);var a=e.date?l(e.date,y):null;t.val(a),P.$setViewValue(a),M&&(e.isOpen=!1,t[0].focus())},e.keydown=function(n){27===n.which&&(n.stopPropagation(),e.isOpen=!1,t[0].focus())},e.select=function(t){if("today"===t){var n=new Date;angular.isDate(e.date)?(t=new Date(e.date),t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate())):t=new Date(n.setHours(0,0,0,0))}e.dateSelection(t)},e.close=function(){e.isOpen=!1,t[0].focus()},e.disabled=angular.isDefined(n.disabled)||!1,n.ngDisabled&&L.push(e.$parent.$watch(r(n.ngDisabled),function(t){e.disabled=t})),e.$watch("isOpen",function(n){n?e.disabled?e.isOpen=!1:(e.position=w?c.offset(t):c.position(t),e.position.top=e.position.top+t.prop("offsetHeight"),p(function(){k&&e.$broadcast("uib:datepicker.focus"),i.on("click",m)},0,!1)):i.off("click",m)})}]).directive("richccDatepickerPopup",function(){return{require:["ngModel","richccDatepickerPopup"],controller:"RichccDatepickerPopupController",scope:{datepickerOptions:"=?",isOpen:"=?",currentText:"@",clearText:"@",closeText:"@",dateDisabled:"&",customClass:"&",customIconClass:"&"},link:function(e,t,n,a){var r=a[0],i=a[1];i.init(r)}}}).directive("richccDatepickerPopupWrap",function(){return{replace:!0,transclude:!0,templateUrl:function(e,t){return t.templateUrl||"template/richcc/popup.html"}}}).directive("ccKey",function(){return{restrict:"AEC",link:function(e,t,n){t.on("click",function(t){1!=n.ngDisabled&&e.$apply(n.ccKey)}),t.on("keyup",function(t){13!=t.keyCode&&32!=t.keyCode||1==n.ngDisabled||e.$apply(n.ccKey)})}}}).service("RichCCService",["dateFilter",function(e){function t(e,t){return t>e?-1:e==t?0:e>t?1:void 0}function n(e,t){var n=[],a=Math.abs(new Date(e).getTime()-new Date(t).getTime()),r=Math.ceil(a/864e5)+1;return _.each(_.range(r),function(t){var a=new Date(e);a=a.setDate(a.getDate()+t),n.push(new Date(a))}),n}function a(e){for(var t=!0,n=1;t;){var a=_.find(e,function(e){return e.order==n});"undefined"==typeof a?t=!1:n+=1}return n}function r(e,t){var n=!1;if(t.length>0){t.length;if(t[0].length>0){var a=t[2][3],r=new Date(a.date.getFullYear(),a.date.getMonth(),1).setHours(0,0,0,0),i=new Date(a.date.getFullYear(),a.date.getMonth()+1,0).setHours(0,0,0,0);e>=r&&i>=e&&(n=!0)}}return n}function i(e,t){var n=[];if(t.length>0){var a=t.length;if(t[0].length>0){var r=t[2][3],i=new Date(r.date.getFullYear(),r.date.getMonth()+1,0).setHours(0,0,0,0);n=_.filter(e,function(e){t[a-1].length;return e>=t[0][0].date&&i>=e&&new Date(e).getMonth()==new Date(i).getMonth()})}}return n}function o(e,t,a){var r=(n(a,t),_.filter(e,function(e){return e>=t}));return r.length}var c=this;return c.datepickerMode="day",c.formatDay="dd",c.formatMonth="MMMM",c.formatYear="yyyy",c.formatDayHeader="EEE",c.formatDayTitle="MMMM yyyy",c.formatMonthTitle="yyyy",c.maxDate=null,c.maxMode="year",c.minDate=null,c.minMode="day",c.ngModelOptions={},c.shortcutPropagation=!1,c.yearColumns=5,c.yearRows=4,c.light=!1,c.yearMapHeat=!1,c.preventModeToggle=!1,c.preventCalNav=!1,c.stopHighlight=!1,c.hideCalNav=!1,c.showMarkerForMoreEvents=!0,c.showDataLabel=!1,c.defaultDataLabel="00=00",c.monthPopUpTmpl="template/richcc/richccMonthPopup.html",c.dayPopUpTmpl="template/richcc/richccDayPopup.html",c.enableWebWorkers=!1,c.expandedMode=!1,c.webWorkerAngularPath="https=//cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.8/angular.min.js",String.prototype.replaceAll=function(e,t){var n=new RegExp(e,"g");return this.replace(n,t)},c.processEventsForMonthEventViewer=function(e,c){var l=_.map(e,function(e){return e._startDt=new Date(e.startDt).setHours(0,0,0,0),e._endDt=new Date(e.endDt).setHours(0,0,0,0),e.startDtFQ||(e.startDtFQ=e._startDt),e.endDtFQ||(e.endDtFQ=e._endDt),e}),s=l.sort(function(e,n){return e._startDt==n._startDt?t(e._endDt,n._endDt):t(e._startDt,n._startDt)}),u={},p={};return _.each(s,function(e){var t=n(e._startDt,e._endDt),l={};angular.extend(l,e),l.order=null,l.first=null,_.each(t,function(n,s){var d=r(n,c);if(1==d){var f=n.getFullYear()+"_"+n.getMonth()+"_"+n.getDate();("undefined"==typeof u[f]||null==u[f])&&(u[f]=[]);var h=l.id+"_"+new Date(l._startDt).getTime()+"_"+n.getMonth();if(1!=p[h]){var v=l.order;l.order=a(u[f]);var g=l.order;if(v!=g&&2>=g){l.startPaintForMonth=!0;var m=i(t,c);l.paintBoxLengthForMonth=o(m,n,new Date(e._startDt)),p[h]=!0}else l.startPaintForMonth=!1}else l.startPaintForMonth=!1;var D=_.clone(l);u[f].push(D)}})}),u},c.processLabels=function(e){var t={};return _.each(e,function(e){var n=new Date(e.dt),a=n.getFullYear()+"_"+n.getMonth()+"_"+n.getDate();t[a]=e.label}),t},c.getDates=function(e,t){for(var n,a=new Array(t),r=new Date(e),i=0;t>i;)n=new Date(r),a[i++]=n,r.setDate(r.getDate()+1);return a},c.split=function(e,t){for(var n=[];e.length>0;)n.push(e.splice(0,t));return n},c._dupCreateDateObject=function(t,n){var a={date:t,label:e(t,n.replace(/d!/,"dd")).replace(/M!/,"MM")};return a},c.processForRows=function(t,n){var a=new Date(t),r=a.getFullYear(),i=a.getMonth(),o=new Date(a),l=0;o.setFullYear(r,i,1);var s=l-o.getDay(),u=s>0?7-s:-s,p=new Date(o);u>0&&p.setDate(-u+1);for(var d=c.getDates(p,42),f=0;42>f;f++)d[f]=angular.extend(c._dupCreateDateObject(d[f],c.formatDay),{secondary:d[f].getMonth()!==i,key:d[f].getFullYear()+"_"+d[f].getMonth()+"_"+d[f].getDate(),monthIndex:d[f].getMonth(),IsCurrMonth:d[f].getMonth()==a.getMonth()}),"function"==typeof n.customClass&&(d[f].customClass=n.customClass({date:d[f].date,mode:"year"})||null),"function"==typeof n.customAriaLabel&&(d[f].customAriaLabel=n.customAriaLabel({date:d[f].date,mode:"year"})||null);var h=new Array(7);c.labels=[];for(var v=0;7>v;v++){var g={abbr:e(d[v].date,c.formatDayHeader),full:e(d[v].date,"EEEE")};c.labels.push(g),h[v]=g}var m=c.labels,D=(e(a,c.formatDayTitle),c.split(d,7)),y=a.getMonth();return{index:y,rows:D,eventMarkers:m}},c}]).directive("richccYear",["RichCCService","$parse","$document",function(e,t,n){return{replace:!0,templateUrl:function(e,t){return t.templateUrl||"template/richcc/richcc-year-tmpl.html"},scope:{datepickerOptions:"=?",ngModel:"=",events:"=",light:"=",eventPopupHide:"=",preventCalNav:"=",preventModeToggle:"=",yearMapHeat:"=",daySelectCallback:"&",eventPopupLeftCallback:"&",eventPopupRightCallback:"&",eventClickCallback:"&",eventPopupSettings:"="},controller:["RichCCService","$timeout","$filter","$scope","$compile","$document",function(e,t,n,a,r,i){var o=this;o.rid=_.uniqueId("richcc"),o.months=[],o.weekDayMarkers=[],o.popUpState={},o.inProgress=!0,o.popUpTriggerYearView=function(e){
try{var t=a.eventPopupSettings;if("undefined"==typeof t||"undefined"==typeof t.showWhenEventsEmpty||1==t.showWhenEventsEmpty)return"undefined"!=typeof t&&"undefined"!=typeof t.showWhenEventsEmpty&&1==t.showWhenEventsEmpty?"outsideClick":"none";if("undefined"==typeof e||null==e||e=={})return"none";if(e.length>0&&1!=t.hidden)return"outsideClick"}catch(n){return"none"}},o.getPopUpPositionForMonthEventMap=function(e,t){var n="";return n=6>e?"bottom":"top"},o.move=function(e){if(!o.inProgress){o.reset();var t=angular.copy(o.dt);t.setFullYear(t.getFullYear()+e),o.processDt(t);var n={datepickerMode:"year",activeDate:t};"function"==typeof a.datepickerOptions.moveModeCallback&&a.$eval(function(){a.datepickerOptions.moveModeCallback(n)})}},o.reset=function(){o.inProgress=!0;var e=angular.element(document.getElementsByClassName("richcc-year-row"));_.each(e,function(e){var t=e.getAttribute("id");angular.element(document.getElementById(t)).empty()}),o.months=[];for(var t in o.popUpState)1==o.popUpState[t]&&(o.popUpState[t]=!1);var n=$(".popover.richcc-popup-container");_.each(n,function(e){$(e).remove()}),_.each(o.eventIds,function(e){i.off(e)})},o.eventIds=[],o.processDt=function(r){o.dt=r,o.title=r.getFullYear(),o.months=[],_.each(_.range(12),function(t){r.setMonth(t),r.setDate(15);var n=e.processForRows(r,a.datepickerOptions);0==t&&(o.weekDayMarkers=n.eventMarkers),n.eventDetails=e.processEventsForMonthEventViewer(a.events,n.rows),o.months.push(n)}),o.paintTimeout&&t.cancel(o.paintTimeout),o.paintTimeout=t(function(){_.each(o.months,function(e,t){_.each(e.rows,function(r,c){var l=angular.element(document.getElementById("row_"+t+"_"+c));_.each(r,function(r,s){var u='<td role="gridcell" class="uib-day text-center richcc-td" id="CELLID"></td>',p=_.uniqueId("richcc_cell_");if(u=u.replace("CELLID",p),l.append(u),1==r.IsCurrMonth){var d=angular.element(document.getElementById(p)),f='<div class="richcc-month-eventbox"><div class="richcc-eventbox-content CUSTOM_CLASS "><div dt="COLUMN_DT_ARIA" mindex="MINDEX" windex="WINDEX" cindex="CINDEX" class="markHolder" style="position:relative;" aria-label="CELL_ARIA_LABEL" id="CELL_ELM_ID"><div class="month-date"> COLUMN_DT_INITIAL </div><div class="richcc-yearly-event-popupoverlay" id="event_pop_trig_EVENTPOPTRIGGERID" key="COLUMN_KEY" mindex="MINDEX" windex="WINDEX" ></div></div></div></div>';f=f.replaceAll("MINDEX",t),f=f.replaceAll("WINDEX",c),f=f.replaceAll("CINDEX",s),f=f.replaceAll("EVENTPOPTRIGGERID",r.key),f=f.replaceAll("COLUMN_KEY",r.key),f=f.replaceAll("COLUMN_DT_INITIAL",n("date")(r.date,"dd")||""),f=f.replaceAll("COLUMN_DT_ARIA",n("date")(r.date,"d")||"");var h="mh_"+r.key;f=f.replaceAll("CELL_ELM_ID",h);var v=new Date(r.date),g=o.monthLabels[v.getMonth()]+" "+v.getDate()+" "+v.getFullYear(),m=e.eventDetails[r.key];m&&m.length>0&&(g=g+" "+m.length+" events"),r.customAriaLabel&&(g=g+" "+r.customAriaLabel),f=f.replaceAll("CELL_ARIA_LABEL",g),f=f.replaceAll("CUSTOM_CLASS",r.customClass||""),d.append(f),"undefined"!=typeof m&&m.length>0&&_.each(m,function(e){if(1==e.startPaintForMonth){var t="<div class=\"mark notrans step-EVENT_STEP  EVENT_ORDER \" style='color:EVENT_COLOR; width:EVENT_WIDTH' > INITIALSTMPL <div class=\"mark-stripe notrans light EVENT_HIGHLIGHT_CLASS\"  style='border-color:EVENT_HIGHLIGHT_BORDER'> <div class=\"mark-stripe-color\" style='background-color:EVENT_BGCOLOR'></div> </div>";1==e.order?t=t.replace("EVENT_ORDER","top"):2==e.order&&(t=t.replace("EVENT_ORDER","bottom")),t=t.replaceAll("EVENT_COLOR",e.bgcolor);var r="";if(1!=a.datepickerOptions.noInitials){var i="<div class=\"mark-text-initial\" style='color:EVENT_COLOR;' > EVENT_INTIAL </div>";i=i.replace("EVENT_INTIAL",n("limitTo")(e.initial,1)||""),t=t.replace("INITIALSTMPL",i),r="calc("+100*e.paintBoxLengthForMonth+"% - 18px)"}else t=t.replace("INITIALSTMPL",""),r="calc("+100*e.paintBoxLengthForMonth+"% - 10px)";t=t.replace("EVENT_WIDTH",r),1==e.highlightBorder&&(t=t.replace("EVENT_HIGHLIGHT_CLASS","highlightBorder")),t=t.replace("EVENT_HIGHLIGHT_BORDER",1==e.highlightBorder?e.highlightBorderColor:"transparent"),t=t.replace("EVENT_BGCOLOR",e.bgcolor);var o=angular.element(document.getElementById(h));o.append(t)}});var D=angular.element(document.getElementById("event_pop_trig_"+r.key)),y="popup_"+r.key;D.on("click",function(e){var t=r,i=$(e.currentTarget).attr("key"),c=parseInt($(e.currentTarget).attr("mindex"))||0,l=parseInt($(e.currentTarget).attr("windex"))||0;for(var s in o.popUpState)if(s!=i&&1==o.popUpState[s]){o.popUpState[s]=!1;var u=angular.element(document.getElementById("event_pop_trig_"+s));$(u).popover("hide")}if(1!=o.popUpState[i]){var p=o.months[c].eventDetails[i],d='<div class="popover richcc-popup-container yearly-only fade in "><div class="arrow"></div><div class="popover-inner"><div class="popover-content"></div></div></div>',f='<div class="richcc-day-popup" tabindex="0" id="POPUPCONTAINERID" key="POPUPCONTAINERKEY"><div class="event-container NOACTIONS "><div class="event-container-label">POPUPDATE<span>POPUPEVENTCOUNT</span></div><div class="event-details-container">POPUPEVENTDETAILSTMPL</div></div><div class="event-action-container POPOVERSINGLEBUTTONLYCLASS "> POPUPLEFTBTNTMPL POPUPRIGHTBTNTMPL <div class="event-separator"></div></div></div>';f=f.replace("POPUPCONTAINERID",y),f=f.replace("POPUPCONTAINERKEY",i),f=f.replace("POPUPDATE",n("date")(t.date,a.eventPopupSettings.labelDateFilter)||""),a.eventPopupSettings.showLeft||a.eventPopupSettings.showRight||(f=f.replace("NOACTIONS","noActions"));var h="";if(m=_.sortBy(m,function(e){return e.isHoliday=e.isHoliday||!1,1==e.isHoliday?-1:1}),_.each(m,function(e,t){var i='<div class="event-detail EVENTHOLIDAYCLASS " tabindex="0" style="background-color:EVENTDETAILBGCOLOR" mindex="MINDEX" key="COLUMNKEY" dt="COLUMNDATE" evid="EVTPRIMARYIDDET" id="EVENTDETAILID" iter="ITERATOR" aria-label="EVENTARIALABEL"><div class="event-marker"></div><div class="event-title-holder POPUPHIGHLIGHTBORDERCLASS" style="border-left-color: POPOVERBGCOLOR"><span class="event-title">EVENTTITLE</span> EVENDETAILSOTHERSTUFF </div></div>';if(i=i.replace("EVTPRIMARYIDDET",e.id),e.ariaLabel&&(i=i.replace("EVENTARIALABEL",e.ariaLabel)),e.highlightBorder&&(i=i.replace("POPUPHIGHLIGHTBORDERCLASS","highlightBorder")),1==e.isHoliday){i=i.replace("EVENTHOLIDAYCLASS","event-holiday"),i=i.replace("EVENTDETAILBGCOLOR",e.bgcolor);var o='<div class="event-timing-holder"><span class="event-time holiday"> EVENTHOLIDAYTYPE </span></div>';o=o.replace("EVENTHOLIDAYTYPE",e.holidayType||""),i=i.replace("EVENDETAILSOTHERSTUFF",o)}else{i=i.replace("EVENTDETAILBGCOLOR","#fff");var o=': <span class="event-subject">EVENTSUBJECT</span><div class="event-timing-holder"><span class="event-time ng-binding">EVENTSTARTIME</span><span style="padding: 0px 15px;">-</span><span class="event-time ng-binding">EVENTENDTIME</span><br/><p class="event-time" style="text-transform:none;"> EVENTTIMEMETADATA</p></div>';o=o.replace("EVENTSUBJECT",e.subject||""),o=o.replace("EVENTSTARTIME",n("date")(e.startDtFQ,a.eventPopupSettings.dateFilter)||""),o=o.replace("EVENTENDTIME",n("date")(e.endDtFQ,a.eventPopupSettings.dateFilter)||""),i=i.replace("EVENDETAILSOTHERSTUFF",o)}i=i.replace("POPOVERBGCOLOR",e.bgcolor),i=i.replace("EVENTTITLE",e.name||""),i=i.replace("EVENTTIMEMETADATA",e.timeMetaData||"");var l=r.key+"_evtdet_"+t;i=i.replace("EVENTDETAILID",l),i=i.replace("MINDEX",c),i=i.replace("ITERATOR",t),i=i.replace("COLUMNKEY",r.key),i=i.replace("COLUMNDATE",r.date.getMonth()+1+"/"+r.date.getDate()+"/"+r.date.getFullYear()),h+=i}),"undefined"!=typeof p&&null!=p&&p.length>0?(f=f.replace("POPUPEVENTCOUNT"," ("+(p.length||0)+(1==p.length?" Event)":" Events)")),f=f.replace("POPUPEVENTDETAILSTMPL",h)):(f=f.replace("POPUPEVENTCOUNT",""),f=f.replace("POPUPEVENTDETAILSTMPL","")),(0!=a.eventPopupSettings.showLeft&&0==a.eventPopupSettings.showRight||0==a.eventPopupSettings.showLeft&&0!=a.eventPopupSettings.showRight)&&(f=f.replace("POPOVERSINGLEBUTTONLYCLASS","singleButtonOnly")),0!=a.eventPopupSettings.showLeft){var v='<button class="event-action" mindex="MINDEX" key="COLUMNKEY" dt="COLUMNDATE" pos="BUTTONPOS" >POPOVERBUTTONTITLE</button>';v=v.replace("BUTTONPOS","LEFT"),v=v.replace("MINDEX",c),v=v.replace("COLUMNKEY",r.key),v=v.replace("COLUMNDATE",r.date.getMonth()+1+"/"+r.date.getDate()+"/"+r.date.getFullYear()),v=v.replace("POPOVERBUTTONTITLE",a.eventPopupSettings.leftLabel||"Add Events"),f=f.replace("POPUPLEFTBTNTMPL",v)}else f=f.replace("POPUPLEFTBTNTMPL","");if(0!=a.eventPopupSettings.showRight){var v='<button class="event-action" mindex="MINDEX" key="COLUMNKEY" dt="COLUMNDATE" pos="BUTTONPOS" >POPOVERBUTTONTITLE</button>';v=v.replace("BUTTONPOS","RIGHT"),v=v.replace("MINDEX",c),v=v.replace("COLUMNKEY",r.key),v=v.replace("COLUMNDATE",r.date.getMonth()+1+"/"+r.date.getDate()+"/"+r.date.getFullYear()),v=v.replace("POPOVERBUTTONTITLE",a.eventPopupSettings.rightLabel||"Add Events"),f=f.replace("POPUPRIGHTBTNTMPL",v)}else f=f.replace("POPUPRIGHTBTNTMPL","");var g=o.getPopUpPositionForMonthEventMap(c,l),D={html:!0,content:f,show:!1,container:"body",trigger:"click",placement:g,template:d};$(e.target).popover(D),$(e.target).popover("show"),o.popUpState[i]=!0}else o.popUpState[i]=!1,$(e.target).popover("hide")}),D.on("shown.bs.popover",function(e){var t=$(e.currentTarget).attr("key"),n="click."+t;o.eventIds.push(n),i.on(n,function(e){var t=$(e.target).closest(".popover");if(0==t.length)for(var n in o.popUpState)if(1==o.popUpState[n]){var a="#event_pop_trig_"+n;$(a).popover("hide"),o.popUpState[n]=!1}}),$(".event-detail").click(function(e){var t=$(e.currentTarget).attr("key"),n=new Date($(e.currentTarget).attr("dt"))||null,r=(parseInt($(e.currentTarget).attr("iter"))||0,parseInt($(e.currentTarget).attr("evid"))||0),i=parseInt($(e.currentTarget).attr("mindex"))||0,c=null,l=o.months[i].eventDetails[t];l.length>0&&(c=_.find(l,function(e){return e.id==r}));var s={dt:n,event:c};"function"==typeof a.eventClickCallback&&a.$eval(function(){a.eventClickCallback({data:s})})}),$(".event-action").click(function(e){var t=$(e.currentTarget).attr("key"),n=new Date($(e.currentTarget).attr("dt"))||null,r=parseInt($(e.currentTarget).attr("mindex"))||0,i=$(e.currentTarget).attr("pos")||"",c=o.months[r].eventDetails[t],l={dt:n,events:c};"LEFT"==i?"function"==typeof a.eventPopupLeftCallback&&a.$eval(function(){a.eventPopupLeftCallback({data:l})}):"RIGHT"==i&&"function"==typeof a.eventPopupRightCallback&&a.$eval(function(){a.eventPopupRightCallback({data:l})})});var c=document.getElementById("popup_"+r.key);if(c){var l="keydown."+t;$(c).off(l),$(c).on(l,function(e){if(27==e.keyCode){o.popUpState[t]=!1;var n=angular.element(document.getElementById("event_pop_trig_"+t));$(n).popover("hide"),e.preventDefault(),e.stopPropagation()}}),$(c).focus()}}),D.on("hidden.bs.popover",function(e){var t=$(e.target).attr("key");o.popUpState[t]=!1;var n="click."+t;i.off(n),o.eventIds=_.reject(o.eventIds,function(e){return e==n});var r=document.getElementById(a.dtPickerYearID);r&&$(r).focus()})}})})}),a.currentYearModelDt=new Date(r),o.focusCurrentCell(),a.initialized=!0,o.inProgress=!1,o.currentYear=a.currentYearModelDt.getFullYear()},300)},o.getUID=function(e){return e?e.getFullYear()+"_"+e.getMonth()+"_"+e.getDate():""},o.focusCurrentCell=function(){if(!e.stopHighlight){var t=document.getElementById(a.dtPickerYearID);if(t&&t.setAttribute("aria-activedescendant","mh_"+o.activeDtID),o.activeDtID){var n=document.getElementById("mh_"+o.activeDtID);n&&n.classList.remove("cc-focus")}o.activeDtID=o.getUID(a.currentYearModelDt);var r=document.getElementById("mh_"+o.activeDtID);r&&r.classList.add("cc-focus")}},a.processEventsChange=function(e){o.reset(),o.processDt(o.dt)},a.init=function(e){o.reset(),o.processDt(e)},o.numOfWeeks=_.range(6),o.popUpTmpl="richCCYearPopUp.html",o.monthLabels=["January","February","March","April","May","June","July","August","September","October","November","December"],o.keyup=function(e){if(27==e.keyCode){for(var t in o.popUpState)if(1==o.popUpState[t]){o.popUpState[t]=!1;var n=angular.element(document.getElementById("event_pop_trig_"+t));$(n).popover("hide")}e.preventDefault(),e.stopPropagation()}},o.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"},o.keydown=function(e){var t=o.keys[e.which];if(t&&!e.shiftKey&&!e.altKey&&!a.disabled)if(e.preventDefault(),"enter"===t||"space"===t)o.triggerPopUpIfAvailable(a.currentYearModelDt);else if("left"===t){var n=a.currentYearModelDt.getFullYear(),r=new Date(angular.copy(a.currentYearModelDt));r=new Date(r.setDate(r.getDate()-1)),r.getFullYear()==n&&(a.currentYearModelDt=new Date(r),o.focusCurrentCell())}else if("right"===t){var n=a.currentYearModelDt.getFullYear(),r=new Date(angular.copy(a.currentYearModelDt));r=new Date(r.setDate(r.getDate()+1)),r.getFullYear()==n&&(a.currentYearModelDt=new Date(r),o.focusCurrentCell())}else if("pageup"===t||"pagedown"===t){var n=a.currentYearModelDt.getFullYear(),r=new Date(angular.copy(a.currentYearModelDt));"pageup"===t?r=new Date(r.setMonth(r.getMonth()>0?r.getMonth()-1:r.getMonth())):"pagedown"===t&&(r=new Date(r.setMonth(r.getMonth()<11?r.getMonth()+1:r.getMonth()))),r.getFullYear()==n&&(a.currentYearModelDt=new Date(r),o.focusCurrentCell())}else if("home"===t||"end"===t){var n=a.currentYearModelDt.getFullYear(),r=new Date(angular.copy(a.currentYearModelDt));r=new Date(r.setMonth("home"===t?0:11)),r=new Date(r.setDate("home"===t?1:31)),r.getFullYear()==n&&(a.currentYearModelDt=new Date(r),o.focusCurrentCell())}else if("up"===t||"down"===t){var i="mh_"+o.activeDtID,c=document.getElementById(i);if(c){var l=c.getAttribute("mindex"),s=c.getAttribute("cindex"),u=c.getAttribute("windex"),p="div[mindex='MINDEX'][cindex='CINDEX'][windex='WINDEX']";l&&(l="up"===t?parseInt(l)-1:parseInt(l)+1),p=p.replace("MINDEX",l),p=p.replace("CINDEX",s),p=p.replace("WINDEX",u);var d=document.querySelector(p);if(d){var f=d.getAttribute("dt"),n=a.currentYearModelDt.getFullYear(),r=new Date(angular.copy(a.currentYearModelDt));r=new Date(r.setMonth(l)),r=new Date(r.setDate(f)),r.getFullYear()==n&&(a.currentYearModelDt=new Date(r),o.focusCurrentCell())}}}},o.triggerPopUpIfAvailable=function(e){var n=document.getElementById("event_pop_trig_"+o.getUID(e));n&&t(function(){$(n).trigger("click")})}}],controllerAs:"ricchYear",link:function(e,t,n){e.initialized=!1,e.$watch("ngModel",function(t,n){"undefined"!=typeof t&&null!=t&&t!={}&&e.init(new Date(t))},!0);e.$watch("events",function(t,n){"undefined"!=typeof t&&null!=t&&t!={}&&1==e.initialized&&e.processEventsChange(t)},!1);e.$on("$destroy",function(){var e=document.getElementsByClassName("richcc-yearly-event-popupoverlay");_.each(e,function(e){var t=angular.element(e);$(t).popover("destroy")})}),e.dtPickerYearID=_.uniqueId("dtPickerYear"),e.datepickerOptions.getCalendarInFocus=function(){var t=document.getElementById(e.dtPickerYearID);t&&$(t).focus()}}}}]);